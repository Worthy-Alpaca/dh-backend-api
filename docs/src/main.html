<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>src.main API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>src.main</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import configparser
import os
import sys
import uvicorn
import numpy as np
from pathlib import Path
from fastapi import FastAPI, Response, status, Request
from os.path import exists

PACKAGE_PARENT = &#34;../&#34;
SCRIPT_DIR = os.path.dirname(
    os.path.realpath(os.path.join(os.getcwd(), os.path.expanduser(__file__)))
)
sys.path.append(os.path.normpath(os.path.join(SCRIPT_DIR, PACKAGE_PARENT)))

try:
    from data.dataloader import DataLoader
    from data.datawrangler import MachineDataLoader
    from data.datawrangler import DataWrangler
    from simulation.cartsetup import CartSetup
    from simulation.machine import Machine
    from simulation.manufacturing import Manufacturing
    from models.deploy import DeployModel
    from schemas import DummyMachine
except:
    from src.data.dataloader import DataLoader
    from src.data.datawrangler import MachineDataLoader
    from src.data.datawrangler import DataWrangler
    from src.simulation.cartsetup import CartSetup
    from src.simulation.machine import Machine
    from src.simulation.manufacturing import Manufacturing
    from src.models.deploy import DeployModel
    from src.schemas import DummyMachine


app = FastAPI()
config = configparser.ConfigParser()
configPath = os.getcwd() + os.path.normpath(&#34;/src/settings.ini&#34;)
if exists(configPath):
    config.read(configPath)
else:
    config.add_section(&#34;default&#34;)
    config.set(&#34;default&#34;, &#34;version&#34;, &#34;1.0&#34;)
    config.add_section(&#34;network&#34;)
    config.set(&#34;network&#34;, &#34;port&#34;, &#34;5000&#34;)
    config.set(&#34;network&#34;, &#34;host&#34;, &#34;127.0.0.1&#34;)
    config.set(&#34;network&#34;, &#34;basepath&#34;, &#34;/api/v7/&#34;)


@app.get(&#34;/&#34;)
def root(response: Response, request: Request):
    &#34;&#34;&#34;endpoint to check base status of API&#34;&#34;&#34;
    response.status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
    if exists(os.getcwd() + os.path.normpath(&#34;/data&#34;)):
        response.status_code = status.HTTP_200_OK
    body = {
        &#34;API Version&#34;: config.get(&#34;default&#34;, &#34;version&#34;),
        &#34;Status&#34;: response.status_code,
        &#34;Headers&#34;: request.headers,
        &#34;Basepath&#34;: config.get(&#34;network&#34;, &#34;basepath&#34;),
    }
    return body


@app.put(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/simulate/coating/&#34;)
def startSimulation(productId: str, dummyMachine: DummyMachine, response: Response):
    &#34;&#34;&#34;endpoint to calculate the coating time for a given product&#34;&#34;&#34;
    # replace this with Database lookup
    path = Path(
        os.getcwd() + os.path.normpath(&#34;/data/programms/&#34; + productId + &#34;/&#34; + &#34;/m20&#34;)
    )
    data = DataLoader(path)
    machine = Machine(dummyMachine)
    manufacturing = Manufacturing(data(), machine)
    simulationData = manufacturing.coating()
    return {&#34;time&#34;: simulationData}


@app.put(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/simulate/manufacturing/&#34;)
def startSimulation(
    productId: str, useIdealState: bool, dummyMachine: DummyMachine, response: Response
):
    &#34;&#34;&#34;endpoint to calculate the manufacturing time for a given product&#34;&#34;&#34;
    # replace this with Database lookup
    path = Path(
        os.getcwd()
        + os.path.normpath(&#34;/data/programms/&#34; + productId + &#34;/&#34; + dummyMachine.machine)
    )
    data = DataLoader(path)
    machine = Machine(dummyMachine)
    try:
        manufacturing = Manufacturing(data(), machine)
        simulationData = manufacturing(plotPCB=True, useIdealState=useIdealState)
    except Exception as e:
        response.status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
        body = {&#34;error&#34;: e}
        return body
    return simulationData


@app.put(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/simulate/AI/&#34;)
def startSimulation(
    productId: str, useIdealState: bool, dummyMachine: DummyMachine, response: Response
):
    &#34;&#34;&#34;endpoint to calculate the manufacturing time for a given product&#34;&#34;&#34;
    # replace this with Database lookup
    path = Path(
        os.getcwd()
        + os.path.normpath(&#34;/data/programms/&#34; + productId + &#34;/&#34; + dummyMachine.machine)
    )
    data = DataLoader(path)
    machine = Machine(dummyMachine)
    try:
        data = data()
        offsets = max(data[2])
        manufacturing = Manufacturing(data, machine)
        plot_x, plot_y = manufacturing.getPlots()
        model = DeployModel(
            Path(os.getcwd() + os.path.normpath(&#34;/data/models/FINAL MODEL&#34;))
        )
        predArray = np.array(
            [
                len(data[0] * len(data[2])),
                0 if machine.machineName == &#34;m10&#34; else 1,
                data[0][&#34;X&#34;].max() + offsets[0],
                data[0][&#34;Y&#34;].max() + offsets[1],
            ]
        )
        predictedData = model.predict(predArray)[0][0]
    except Exception as e:
        response.status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
        body = {&#34;error&#34;: e}
        return body
    return {&#34;time&#34;: float(predictedData), &#34;plot_x&#34;: plot_x, &#34;plot_y&#34;: plot_y}


@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/simulate/setup/&#34;)
def setupSimulation(
    productId: str,
    machine: str,
    randomInterMin: int,
    randomInterMax: int,
    response: Response,
):
    &#34;&#34;&#34;endpoint to calculate the setup time for a given product&#34;&#34;&#34;
    path = Path(
        os.getcwd() + os.path.normpath(&#34;/data/programms/&#34; + productId + &#34;/&#34; + machine)
    )
    try:
        data = DataLoader(path)
    except:
        return {&#34;time&#34;: 420}

    setupM20 = CartSetup(data(), randomInterMin, randomInterMax)
    timeM20 = setupM20()
    return timeM20


@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/predict/order/&#34;)
async def predictOrder(request: Request, response: Response):
    &#34;&#34;&#34;endpoint to predict the best order of products between two given times&#34;&#34;&#34;
    request.body()
    print(request.query_params.get(&#34;startdate&#34;))
    print(request.query_params.get(&#34;enddate&#34;))


@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/data/machinedata/&#34;)
def getMachineData(response: Response):
    &#34;&#34;&#34;endpoint to receive machinedata&#34;&#34;&#34;
    try:
        data = MachineDataLoader()
    except:
        response.status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
        return response

    return data.returnData()


@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/data/options/&#34;)
def getOptions():
    &#34;&#34;&#34;endpoint to get all available programms&#34;&#34;&#34;
    # replace with DB lookup for all possible programms
    path = Path(os.getcwd() + os.path.normpath(&#34;/data/programms&#34;))

    return {&#34;programms&#34;: os.listdir(path)}


if __name__ == &#34;__main__&#34;:
    uvicorn.run(
        &#34;main:app&#34;,
        host=config.get(&#34;network&#34;, &#34;host&#34;),
        port=config.getint(&#34;network&#34;, &#34;port&#34;),
        log_level=&#34;debug&#34;,
        reload=True,
    )</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="src.main.getMachineData"><code class="name flex">
<span>def <span class="ident">getMachineData</span></span>(<span>response: starlette.responses.Response)</span>
</code></dt>
<dd>
<div class="desc"><p>endpoint to receive machinedata</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/data/machinedata/&#34;)
def getMachineData(response: Response):
    &#34;&#34;&#34;endpoint to receive machinedata&#34;&#34;&#34;
    try:
        data = MachineDataLoader()
    except:
        response.status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
        return response

    return data.returnData()</code></pre>
</details>
</dd>
<dt id="src.main.getOptions"><code class="name flex">
<span>def <span class="ident">getOptions</span></span>(<span>)</span>
</code></dt>
<dd>
<div class="desc"><p>endpoint to get all available programms</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/data/options/&#34;)
def getOptions():
    &#34;&#34;&#34;endpoint to get all available programms&#34;&#34;&#34;
    # replace with DB lookup for all possible programms
    path = Path(os.getcwd() + os.path.normpath(&#34;/data/programms&#34;))

    return {&#34;programms&#34;: os.listdir(path)}</code></pre>
</details>
</dd>
<dt id="src.main.predictOrder"><code class="name flex">
<span>async def <span class="ident">predictOrder</span></span>(<span>request: starlette.requests.Request, response: starlette.responses.Response)</span>
</code></dt>
<dd>
<div class="desc"><p>endpoint to predict the best order of products between two given times</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/predict/order/&#34;)
async def predictOrder(request: Request, response: Response):
    &#34;&#34;&#34;endpoint to predict the best order of products between two given times&#34;&#34;&#34;
    request.body()
    print(request.query_params.get(&#34;startdate&#34;))
    print(request.query_params.get(&#34;enddate&#34;))</code></pre>
</details>
</dd>
<dt id="src.main.root"><code class="name flex">
<span>def <span class="ident">root</span></span>(<span>response: starlette.responses.Response, request: starlette.requests.Request)</span>
</code></dt>
<dd>
<div class="desc"><p>endpoint to check base status of API</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.get(&#34;/&#34;)
def root(response: Response, request: Request):
    &#34;&#34;&#34;endpoint to check base status of API&#34;&#34;&#34;
    response.status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
    if exists(os.getcwd() + os.path.normpath(&#34;/data&#34;)):
        response.status_code = status.HTTP_200_OK
    body = {
        &#34;API Version&#34;: config.get(&#34;default&#34;, &#34;version&#34;),
        &#34;Status&#34;: response.status_code,
        &#34;Headers&#34;: request.headers,
        &#34;Basepath&#34;: config.get(&#34;network&#34;, &#34;basepath&#34;),
    }
    return body</code></pre>
</details>
</dd>
<dt id="src.main.setupSimulation"><code class="name flex">
<span>def <span class="ident">setupSimulation</span></span>(<span>productId: str, machine: str, randomInterMin: int, randomInterMax: int, response: starlette.responses.Response)</span>
</code></dt>
<dd>
<div class="desc"><p>endpoint to calculate the setup time for a given product</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.get(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/simulate/setup/&#34;)
def setupSimulation(
    productId: str,
    machine: str,
    randomInterMin: int,
    randomInterMax: int,
    response: Response,
):
    &#34;&#34;&#34;endpoint to calculate the setup time for a given product&#34;&#34;&#34;
    path = Path(
        os.getcwd() + os.path.normpath(&#34;/data/programms/&#34; + productId + &#34;/&#34; + machine)
    )
    try:
        data = DataLoader(path)
    except:
        return {&#34;time&#34;: 420}

    setupM20 = CartSetup(data(), randomInterMin, randomInterMax)
    timeM20 = setupM20()
    return timeM20</code></pre>
</details>
</dd>
<dt id="src.main.startSimulation"><code class="name flex">
<span>def <span class="ident">startSimulation</span></span>(<span>productId: str, useIdealState: bool, dummyMachine: <a title="src.schemas.DummyMachine" href="schemas.html#src.schemas.DummyMachine">DummyMachine</a>, response: starlette.responses.Response)</span>
</code></dt>
<dd>
<div class="desc"><p>endpoint to calculate the manufacturing time for a given product</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@app.put(config.get(&#34;network&#34;, &#34;basepath&#34;) + &#34;/simulate/AI/&#34;)
def startSimulation(
    productId: str, useIdealState: bool, dummyMachine: DummyMachine, response: Response
):
    &#34;&#34;&#34;endpoint to calculate the manufacturing time for a given product&#34;&#34;&#34;
    # replace this with Database lookup
    path = Path(
        os.getcwd()
        + os.path.normpath(&#34;/data/programms/&#34; + productId + &#34;/&#34; + dummyMachine.machine)
    )
    data = DataLoader(path)
    machine = Machine(dummyMachine)
    try:
        data = data()
        offsets = max(data[2])
        manufacturing = Manufacturing(data, machine)
        plot_x, plot_y = manufacturing.getPlots()
        model = DeployModel(
            Path(os.getcwd() + os.path.normpath(&#34;/data/models/FINAL MODEL&#34;))
        )
        predArray = np.array(
            [
                len(data[0] * len(data[2])),
                0 if machine.machineName == &#34;m10&#34; else 1,
                data[0][&#34;X&#34;].max() + offsets[0],
                data[0][&#34;Y&#34;].max() + offsets[1],
            ]
        )
        predictedData = model.predict(predArray)[0][0]
    except Exception as e:
        response.status_code = status.HTTP_500_INTERNAL_SERVER_ERROR
        body = {&#34;error&#34;: e}
        return body
    return {&#34;time&#34;: float(predictedData), &#34;plot_x&#34;: plot_x, &#34;plot_y&#34;: plot_y}</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="src" href="index.html">src</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="src.main.getMachineData" href="#src.main.getMachineData">getMachineData</a></code></li>
<li><code><a title="src.main.getOptions" href="#src.main.getOptions">getOptions</a></code></li>
<li><code><a title="src.main.predictOrder" href="#src.main.predictOrder">predictOrder</a></code></li>
<li><code><a title="src.main.root" href="#src.main.root">root</a></code></li>
<li><code><a title="src.main.setupSimulation" href="#src.main.setupSimulation">setupSimulation</a></code></li>
<li><code><a title="src.main.startSimulation" href="#src.main.startSimulation">startSimulation</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>